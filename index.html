<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="alternate icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANTSURBVHgBvVeNTdtAFH7vbCilUptuYFQihUhNzQQJEzSZoGSChgkIEwATNJ0AmICM4ISKWCKoHiGtVDUCn1/v2cRx4nNIcNRPgpzvnd/fvT8jLAnLsgrGVqEOQlaR0AYECwgKIRFhpNYeITkQYFeOf195njdahi8+K7hUsgzcaCPi51jgElDKdGTweOK5rgcvUYAtNl+/PVbLFuSBoDP/j3Hiec5oaQUiqzevFdGCNYAAPEkPBzpviPmNYrlsr1M4g3kxz2KxbGtoU6zb8nnoPBF7IIzyOeH8gvp/Gf2uCJUZRNRRK2e6FXnCsuxCSgEOuJTlBO3h4KZxP+jvKGbNWBFOu5AxdeO/aO9JMBwOb/vv792bJlBwNKsXWOYbeZx4jlxv4ubPlBG+2L+7c2ILLFtpPh4XslLLKtkWjGGUjHjeMzFI8fbpYYf5mPzAea5j+GjATOp4Tsg4s8B4ruPBkjDEBnuhKdgqBPyiPQSyBjlhZgS0qqZ1jgVhjGVddyCMWDC6kBP+FjgZQaxKu6wLFQU10GvQXsWlWeBrQwqaeqqoClXjP+lIciyuYE0Yuj+mWZIACrI5Da15Arssq3bngAdpQZZYpcPlApHOoIKA/wVEraFCezdhZbbX6xkCW7M7Yg94uvPGtqzCmrBbsmtaAoInKICelkY5B5EECOWhdj9AR0TNRKtCbXevkluJ4l7la1alZdlCbhmXujh4wuluuXIMOYSrlD7LonOtCbvhh71KRy0iLQlOwukW8HTSnrkuKFedEYne0HW6sEho0bbBDKqEcJgReJEYws6922s+teNpywzrtqQjuW10zYfgOs0EL4eDXkPHdLf88UJdeB2WgE9ih0t9WAd4oQSfh+yVPmjgN+77fiAaqUZC8jyTa0DZtCQLJWvSZ+JCJF+JdkIYj2ctPiRJHPALPF4p5VphXc/AIlpCuCf/ivbkeW4otdXMFsRzIfq+mohuHVgBKnNooXBlULLLpr4LeCwPyLyIA1B94QhCJyDxS2Dw7m7QP3+JAmEgo2goe2YMyvgwmfVEEsNBH1dVQGf5BNpmxAd5EuaUhJzg+FF3vp813CzshkO33+Z0UUy+w7LgohaO5tjhd5UhrbXMFtwdeXx/9py6vlU66T98qp4a9HCubgAAAABJRU5ErkJggg==">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNiAwQzcuMTYgMCAwIDcuMTYgMCAxNkMwIDIzLjA4IDQuNTggMjkuMDYgMTAuOTQgMzEuMThDMTEuNzQgMzEuMzIgMTIuMDQgMzAuODQgMTIuMDQgMzAuNDJDMTIuMDQgMzAuMDQgMTIuMDIgMjguNzggMTIuMDIgMjcuNDRDOCAyOC4xOCA2Ljk2IDI2LjQ2IDYuNjQgMjUuNTZDNi40NiAyNS4xIDUuNjggMjMuNjggNSAyMy4zQzQuNDQgMjMgMy42NCAyMi4yNiA0Ljk4IDIyLjI0QzYuMjQgMjIuMjIgNy4xNCAyMy40IDcuNDQgMjMuODhDOC44OCAyNi4zIDExLjE4IDI1LjYyIDEyLjEgMjUuMkMxMi4yNCAyNC4xNiAxMi42NiAyMy40NiAxMy4xMiAyMy4wNkM5LjU2IDIyLjY2IDUuODQgMjEuMjggNS44NCAxNS4xNkM1Ljg0IDEzLjQyIDYuNDYgMTEuOTggNy40OCAxMC44NkM3LjMyIDEwLjQ2IDYuNzYgOC44MiA3LjY0IDYuNjJDNy42NCA2LjYyIDguOTggNi4yIDEyLjA0IDguMjZDMTMuMzIgNy45IDE0LjY4IDcuNzIgMTYuMDQgNy43MkMxNy40IDcuNzIgMTguNzYgNy45IDIwLjA0IDguMjZDMjMuMSA2LjE4IDI0LjQ0IDYuNjIgMjQuNDQgNi42MkMyNS4zMiA4LjgyIDI0Ljc2IDEwLjQ2IDI0LjYgMTAuODZDMjUuNjIgMTEuOTggMjYuMjQgMTMuNCAyNi4yNCAxNS4xNkMyNi4yNCAyMS4zIDIyLjUgMjIuNjYgMTguOTQgMjMuMDZDMTkuNTIgMjMuNTYgMjAuMDIgMjQuNTIgMjAuMDIgMjYuMDJDMjAuMDIgMjguMTYgMjAgMjkuODggMjAgMzAuNDJDMjAgMzAuODQgMjAuMyAzMS4zNCAyMS4xIDMxLjE4QzI3LjQyIDI5LjA2IDMyIDIzLjA2IDMyIDE2QzMyIDcuMTYgMjQuODQgMCAxNiAwVjBaIiBmaWxsPSIjMjQyOTJFIi8+Cjwvc3ZnPgo=">
<title>Letter frequency [2k1dmg/letter-frequency]</title>
<style>
#container {
	display: flex;
	justify-content: space-between;
}
#intext, #outtext {
	min-height: 400px;
	width: calc(50% - 28px);
	padding: 10px;
	margin-top: 10px;
	word-wrap: break-word;
}
#intext {
	outline: 0;
	border: 1px solid #d9d9d9;
	max-width: calc(50% - 30px);
	min-width: calc(50% - 30px);
	max-height: 600px;
}
#intext:hover {
	box-shadow: 0 1px 3px rgba(0,0,0,.3) inset;
}
#intext:focus {
	border-color: #4d90fe;
}
#outtext {
	background-color: whitesmoke;
	overflow-y: scroll;
	max-height: 600px;
}
@media only screen and (max-width: 768px) {
	#container {
		display: block;
	}
	#intext {
		max-width: calc(100% - 20px);
		min-width: calc(100% - 20px);
	}
	#intext, #outtext {
		width: calc(100% - 22px);
		min-height: 150px;
	}
	#outtext {
		height: 200px;
	}
}
#gitlink {
	font-weight: bold;
	font-family: monospace;
	text-decoration: none;
	color: #555;
	position: absolute;
	top: 5pt;
	right: 5pt;
}
#gitlink:hover {
	color: #222;
}
#gitlink:active {
	color: #4169e1; 
}
input {
	margin-bottom: 8px;
}
#options {
	height: 17pt;
}
</style>
<script>
'use strict';

const MENU_LIST = [
	['Letter', '\\p{L}'],
	['Latin', '\\p{Script=Latin}'],
	['Non Latin', '\\p{L}'],
	['Cyrillic', '\\p{Script=Cyrillic}'],
	['Non Cyrillic', '\\p{L}'],
	['Mark', '\\p{M}'],
	['Number', '\\p{N}'],
	['Symbol', '\\p{S}'],
	['Punctuation', '\\p{P}'],
	['Separator', '\\p{Z}'],
	['Other', '\\p{C}'],
	['Emoji', '\\p{Emoji_Presentation}'],
	['Any', '\\p{Any}'],
	['Assigned', '\\p{Assigned}'],
	['ASCII', '\\p{ASCII}'],
	['Latin English', '[A-Za-z]'],
	['Cyrillic Russian', '[А-ЯЁа-яё]']
];

let param = {
	lettersCase: false,
	lettersTurk: false,
	re: /\p{L}/gu
};

function initPage() {
	MENU_LIST.forEach(function(item) {
		countMenu.appendChild(new Option(item[0], item[1]));
	});
	
	countMenu.onchange = function(event) {
		let index = countMenu.options.selectedIndex;
		let value = countMenu.options[index].value;
		let flag = /^\\p/i.test(value) ? 'gu' : 'g';
		param.re = new RegExp(value, flag);
		letterFrequency();
	};
	lettersCase.onchange = function(event) {
		lettersTurk.disabled = lettersCase.checked ? true : false;
		
		param.lettersCase = lettersCase.checked;
		letterFrequency();
	};
	lettersTurk.onchange = function(event) {
		param.lettersTurk = lettersTurk.checked;
		letterFrequency();
	};
}

function getPercent(totalValue, value) {
	return ((value / totalValue) * 100).toFixed(3);
}

function getHEXcodeOf(char) {
	return char.codePointAt(0).toString(16).padStart(4, '0');
}

function checkVisibilityOf(char) {
	switch(char.charCodeAt(0)) {
		case 9:
			return '[HT]';
		case 10:
			return '[LF]';
		case 11:
			return '[VT]';
		case 12:
			return '[FF]';
		case 13:
			return '[CR]';
		case 32:
			return '[space]';
		case 160:
			return '[NBS]';
		case 8203:
			return '[ZWS]';
		case 8205:
			return '[ZWJ]';
		case 8206:
			return '[LTRM]';
		case 65039:
			return '[VS16]';
	}
	return char;
}

function turkLetters(letter) {
	switch(letter) {
		case 'i':
		case 'İ':
			return 'i';
		case 'ı':
		case 'I':
			return 'ı';
	}
	return letter.toLowerCase();
}

function getLowerCaseLetter(letter) {
	switch(letter) {
		case 'İ':
			return 'i';
	}
	return letter.toLowerCase();
}

function getBytesLengthOf(char) {
	return unescape(encodeURIComponent(char)).length;
}

function getLetters(lettersList) {
	let letters = {};
	for(let letter of lettersList) {
		let letterLow;
		if(param.lettersCase) {
			letterLow = letter;
		}
		else {
			if(param.lettersTurk) {
				letterLow = turkLetters(letter);
			}
			else {
				letterLow = getLowerCaseLetter(letter);
			}
		}
		if(letters[letterLow]) {
			letters[letterLow]++
		}
		else {
			letters[letterLow] = 1;
		}
	}
	return letters;
}

function getSum(letters) {
	let sum = 0;
	let bytesLength = 0;
	let charsByBytes = {};
	for(let letter in letters) {
		let letterCount = parseInt(letters[letter]);
		sum += letterCount;
		let letterLength = getBytesLengthOf(letter);
		bytesLength += letterCount * letterLength;
		
		if(charsByBytes[letterLength]) {
			charsByBytes[letterLength] += letterCount;
		}
		else {
			charsByBytes[letterLength] = letterCount;
		}
	}
	return [sum, bytesLength, charsByBytes];
}

function getResult(sum, letters) {
	let lettersCount = [];
	for(let letter in letters) {
		lettersCount.push(
			[
				checkVisibilityOf(letter),
				letters[letter],
				getPercent(sum, letters[letter]),
				letter.codePointAt(0),
				getHEXcodeOf(letter),
				getBytesLengthOf(letter)
			]
		);
	}
	lettersCount.sort(function(a, b) {
		return b[1] - a[1];
	});
	return lettersCount;
}

function showResult(lettersCount, sum, bytesLength, charsByBytes, timeStart) {
	lettersCount.unshift(['char','count','%','code','hex','byte']);

	lettersCount.push(
		['('+(lettersCount.length-1)+')','('+sum+')'],
		[''],
		['bytes: '+ bytesLength],
		['']
	);
	
	for(let i in charsByBytes) {
		lettersCount.push([i +' byte char: ' + charsByBytes[i]]);
	}

	let timeEnd = Date.now();
	lettersCount.push(
		[''],
		['time: '+ ((timeEnd - timeStart)/1000) + ' seconds']
	);

	lettersCount = lettersCount.map(function(a) {
		return a.join('\t');
	});
	
	outtext.textContent = lettersCount.join('\n');	
}

function letterFrequency() {
	if(intext.value == '')
		return;

	outtext.textContent = '';

	let timeStart = Date.now();
	
	let lettersList;
	let index = countMenu.options.selectedIndex;
	let selected = countMenu.options[index].text;
	switch(selected) {
		case 'Non Latin':
			lettersList = intext.value.replace(/\p{Script=Latin}/gu,'').match(param.re);
			break;
		case 'Non Cyrillic':
			lettersList = intext.value.replace(/\p{Script=Cyrillic}/gu,'').match(param.re);
			break;
		default:
			lettersList = intext.value.match(param.re);
	}

	if(!lettersList) {
		outtext.textContent = 'There is no match with the current counting option.';
		return;
	}

	let letters = getLetters(lettersList);

	let [sum, bytesLength, charsByBytes] = getSum(letters);
	
	let lettersCount = getResult(sum, letters);
	
	showResult(lettersCount, sum, bytesLength, charsByBytes, timeStart);
}

function clearAll() {
	intext.value = '';
	outtext.textContent = '';
}

function keyup(event) {
	if(event.keyCode==13 && event.ctrlKey)
		letterFrequency();
}
</script>
</head>
<body onkeyup="keyup(event)" onload="initPage()">
<input type="button" name="letterFrequency" value="Count" title="ctrl + enter" onclick="letterFrequency();">
<label>frequency of</label>
<select id="countMenu"></select>
<br>
<input type="button" name="clearAll" value="Clear" onclick="clearAll();">
<label for="lettersCase">Case sensitivity</label>
<input type="checkbox" name="lettersCase" id="lettersCase" title="Case sensitivity">
<label for="lettersTurk">Letters «İ ı»</label>
<input type="checkbox" name="lettersTurk" id="lettersTurk" title="Letters «İ ı»">
<div id="container">
	<textarea id="intext" spellcheck="false" onpaste="setTimeout(letterFrequency, 10);"></textarea>
	<pre id="outtext"></pre>
	<a href="https://github.com/2k1dmg/letter-frequency" id="gitlink" target="_blank" title="2k1dmg/letter-frequency">GitHub</a>
</div>
</body>
</html>
